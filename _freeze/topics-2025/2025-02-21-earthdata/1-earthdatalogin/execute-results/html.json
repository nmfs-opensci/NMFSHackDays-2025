{
  "hash": "312b28c781f763d7c8dd9aefc674098b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Earthdata Search and Discovery\nauthor: Eli Holmes adapted from work by Luis Lopez and Carl Boettiger\n---\n\n\n\n::: {.callout-note title=\"Learning Objectives\"}\n1.  How to authenticate with `earthdatalogin`\n2.  How to use `earthdatalogin` to search for data using spatial and temporal filters\n3.  How to make a plot without downloading the data\n:::\n\n## Summary\n\nIn this example we will use the `earthdatalogin` R package to search for data collections from NASA Earthdata. `earthdatalogin` is a R package that simplifies data discovery and access to NASAâ€™s [Common Metadata Repository (CMR) API](https://cmr.earthdata.nasa.gov/search/site/docs/search/api.html) Search API for [NASA Earthdata](https://search.earthdata.nasa.gov/search). Despite the name, the NASA Earthdata also holds NOAA data (which we will use today).\n\nFor more on `earthdatalogin` visit the [`earthdatalogin` GitHub](https://github.com/boettiger-lab/earthdatalogin/) page and/or the [`earthdatalogin` documentation](https://boettiger-lab.github.io/earthdatalogin/) site. Be aware that `earthdatalogin` is under active development.\n\n## Terminology\n\n-   **`NetCDF` files**: network Common Data Form; is a file format for storing multidimensional scientific data (variables) such as temperature, humidity, pressure, wind speed, and direction. Each of these variables can be displayed through a dimension (such as time) in ArcGIS by making a layer or table view from the netCDF file. Learn more [here](https://pro.arcgis.com/en/pro-app/latest/help/data/multidimensional/what-is-netcdf-data.htm).\n-   **`tif` or `tiff` or geo tiff file**: is used as an interchange format for georeferenced raster imagery. GeoTIFF is in wide use in NASA Earth science data systems. Learn more [here](https://www.earthdata.nasa.gov/esdis/esco/standards-and-practices/geotiff).\n-   **raster**: is a matrix of cells (or pixels) organized into rows and columns (or a grid) where each cell contains a value representing information, such as temperature. Rasters are digital aerial photographs, imagery from satellites, digital pictures, or even scanned maps.Learn more [here](https://desktop.arcgis.com/en/arcmap/latest/manage-data/raster-and-images/what-is-raster-data.htm).\n-   **GDAL**: is a translator library for raster and vector geospatial data formats. As a library, it presents a single raster abstract data model and single vector abstract data model to the calling application for all supported formats. It also comes with a variety of useful command line utilities for data translation and processing. Learn more [here](https://gdal.org/index.html).\n\n## Prerequisites\n\nAn Earthdata Login account is required to access data from NASA Earthdata. Please visit <https://urs.earthdata.nasa.gov> to register as a new user and manage your Earthdata Login account. This account is free to create and only takes a moment to set up.\n\n## Load Required Packages\n\nWe are using the JupyterHub and all necessary packages are already installed for you. If you are running locally, you can install the packages with\n\n```         \ndevtools::install_github(\"boettiger-lab/earthdatalogin\")\ninstall.packages(\"terra\")\n```\n\nBut be aware that it is common to run into trouble getting GDAL set up properly to handle netCDF files. Using a Docker image like Rocker geospatial is often less aggravating.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(earthdatalogin)\nlibrary(terra)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nterra 1.7.83\n```\n\n\n:::\n:::\n\n\n\n## Authentication for NASA Earthdata\n\nWe will start by authenticating using our Earthdata Login credentials. Authentication is not necessarily needed to search for publicly available data collections in Earthdata, but is always needed to download or access data from the NASA Earthdata archives. We can use `edl_netrc()` from the `earthdatalogin` package to create a `.netrc` file that will store our credentials.\n\nThe first time you run authentication use this code. Note, do this even if you authenticated in Jupyter Lab earlier. This netrc file is placed in a different location.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthdatalogin::edl_netrc(\n  username = \"user\", # add your user name\n  password = \"password\" # add you password\n)\n```\n:::\n\n\n\nThis will put your login info in a `netrc` file located at:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthdatalogin:::edl_netrc_path()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"/home/jovyan/.local/share/R/earthdatalogin/netrc\"\n```\n\n\n:::\n:::\n\n\n\nOnce your `netrc` file is saved, you can authenticate.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthdatalogin::edl_netrc()\n```\n:::\n\n\n\n*`edl_netrc()` will also work by using a default public account login, but feel free to login with your own [NASA Earthdata account](https://urs.earthdata.nasa.gov/home)*\n\n## Search for data\n\nThere are multiple keywords we can use to discover data from collections. The table below contains the `short_name`, `concept_id`, and `doi` for some collections we are interested in for the tutorials today. Each of these can be used to search for data or information related to the collection we are interested in.\n\n| Shortname                  | Collection Concept ID | DOI                 |\n|----------------------------|-----------------------|---------------------|\n| MUR-JPL-L4-GLOB-v4.1       | C1996881146-POCLOUD   | 10.5067/GHGMR-4FJ04 |\n| AVHRR_OI-NCEI-L4-GLOB-v2.1 | C2036881712-POCLOUD   | 10.5067/GHAAO-4BC21 |\n\nHow can we find the `shortname`, `concept_id`, and `doi` for collections not in the table above? Let's take a quick detour:\n\n1.  Navigate to <https://search.earthdata.nasa.gov/search> 2: Search for \"GHRSST Level 4 MUR Global Foundation Sea Surface Temperature Analysis\" or click this [link](https://search.earthdata.nasa.gov/search?q=GHRSST%20Level%204%20MUR%20Global%20Foundation%20Sea%20Surface%20Temperature%20Analysis) (screenshot below).\n\n![](images/SST_Blended_Earthdata_Search.png){width=\"50%\"}\n\nFind and click on the more information button (an i with a circle around it). On this page, you will see the `DOI`. Now click \"View More Info\" to get to <https://cmr.earthdata.nasa.gov/search/concepts/C1996881146-POCLOUD.html>.\n\nOn that page you will see the **\"short name\"** `MUR-JPL-L4-GLOB-v4.1` and below that in an unlabelled box is the Concept ID.\n\n### Search by short name\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nshort_name <- 'MUR-JPL-L4-GLOB-v4.1'\n```\n:::\n\n\n\nLet's set some time bounds.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntbox <- c(\"2020-01-16\", \"2020-12-16\")\n```\n:::\n\n\n\nAnd now we search!\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nresults <- earthdatalogin::edl_search(\n    short_name = short_name,\n    version = \"4.1\",\n    temporal = tbox\n)\nlength(results) # how many links were returned\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 336\n```\n\n\n:::\n\n```{.r .cell-code}\nresults[1:3] # let's see the first 3 of these links\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20200116090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc\"\n[2] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20200117090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc\"\n[3] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20200118090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc\"\n```\n\n\n:::\n:::\n\n\n\nIn this example we used the `short_name` parameter to search from our desired data set. However, there are multiple ways to specify the collection(s) we are interested in. Alternative parameters include:\n\n-   `doi`: request collection by digital object identifier (e.g., `doi = '10.5067/GHAAO-4BC21'`)\n\n**NOTE:** Each Earthdata collect has a unique `concept_id` and `doi`. This is not the case with `short_name`, which can be associated with multiple versions of a collection. If multiple versions of a collection are publicly available, using the `short_name` parameter with return all versions available. It is advised to use the `version` parameter in conjunction with the `short_name` parameter with searching.\n\nWe can refine our search by passing more parameters that describe the spatiotemporal domain of our use case. Here, we use the `temporal` parameter to request a date range and the `bounding_box` parameter to request granules that intersect with a bounding box.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nbbox <- c(xmin=-73.5, ymin=33.5, xmax=-43.5, ymax=43.5) \nbbox\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n xmin  ymin  xmax  ymax \n-73.5  33.5 -43.5  43.5 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nresults <- earthdatalogin::edl_search(\n    short_name = short_name,\n    version = \"4.1\",\n    temporal = tbox,\n    bounding_box = paste(bbox,collapse=\",\")\n)\nlength(results)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 336\n```\n\n\n:::\n\n```{.r .cell-code}\nresults[1:3]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20200116090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc\"\n[2] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20200117090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc\"\n[3] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/MUR-JPL-L4-GLOB-v4.1/20200118090000-JPL-L4_GHRSST-SSTfnd-MUR-GLOB-v02.0-fv04.1.nc\"\n```\n\n\n:::\n:::\n\n\n\n## Working with `earthdatalogin` returns\n\nFollowing the search for data, you'll likely take one of two pathways with those results. You may choose to **download** the assets that have been returned to you or you may choose to continue working with the search results within the R environment.\n\n### Download `earthdatalogin` results\n\nIn some cases you may want to download your assets. The `earthdatalogin::edl_download()` function makes downloading the data from the search results very easy. We won't download the MUR SST file for this tutorial because it is 673 Gb, but you could with the code below, if inclined.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nearthdatalogin::edl_download(\n    results[1],\n    dest = here::here(\"test.nc\")\n)\n```\n:::\n\n\n\n### Work in the cloud\n\nWe do not have to download the data to work with it or at least not until we need to compute with it or plot it. Let's look at a smaller dataset.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\noi <- earthdatalogin::edl_search(\n    short_name = \"AVHRR_OI-NCEI-L4-GLOB-v2.1\",\n    version = \"2.1\",\n    temporal = c(\"2020-01-16\", \"2020-01-17\")\n)\noi\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/AVHRR_OI-NCEI-L4-GLOB-v2.1/20200115120000-NCEI-L4_GHRSST-SSTblend-AVHRR_OI-GLOB-v02.0-fv02.1.nc\"\n[2] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/AVHRR_OI-NCEI-L4-GLOB-v2.1/20200116120000-NCEI-L4_GHRSST-SSTblend-AVHRR_OI-GLOB-v02.0-fv02.1.nc\"\n[3] \"https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/AVHRR_OI-NCEI-L4-GLOB-v2.1/20200117120000-NCEI-L4_GHRSST-SSTblend-AVHRR_OI-GLOB-v02.0-fv02.1.nc\"\n```\n\n\n:::\n:::\n\n\n\nLet's try plotting this. I am going to authenticate again just to make sure my token did not expire. To search, we don't need to authenticate, but to plot or download, we do.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Re-authenticate (just in case)\nearthdatalogin::edl_netrc()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(terra)\nras <- terra::rast(x = oi[1], vsi=TRUE)\nplot(ras)\n```\n\n::: {.cell-output-display}\n![](1-earthdatalogin_files/figure-html/unnamed-chunk-13-1.png){width=672}\n:::\n:::\n\n\n\n::: {.callout-note title=\"Troubleshooting\"}\nIf you get the following error:\n\n> Error: \\[rast\\] file does not exist: /vsicurl/https://archive.podaac.earthdata.nasa.gov/podaac-ops-cumulus-protected/AVHRR_OI-NCEI-L4-GLOB-v2.1/20200115120000-NCEI-L4_GHRSST-SSTblend-AVHRR_OI-GLOB-v02.0-fv02.1.nc\n\nIt is likely because you do not have the End User Licence Agreement (EULA)/permissions to use that data set or are not properly logged in using `earthdatalogin::edl_netrc()`. Another reason may be that your GDAL installation is not properly handling `netCDF` files.\n:::\n\nAlso try this example script from the `?earthdatalogin::edl_netrc` documentation that uses a `.tif` file instead of `.netCDF`.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nurl <- earthdatalogin::lpdacc_example_url()\nras <- terra::rast(url, vsi=TRUE)\nplot(ras)\n```\n\n::: {.cell-output-display}\n![](1-earthdatalogin_files/figure-html/unnamed-chunk-14-1.png){width=672}\n:::\n:::\n\n\n\nHow to you accept EULA's? Go to <https://urs.earthdata.nasa.gov/profile>. Look for the EULA tab and accept the one that looks likely. Unfortunately, it is hard to find out which one you need. You can just accept all of them (or all that look possible). Then try your code again.\n\n## Conclusion\n\nThis concludes tutorial 1. You have worked with remote-sensing data in the cloud and plotted it.\n\nNext we will learn to subset the data so we can work with bigger datasets in the cloud without downloading the whole dataset.\n",
    "supporting": [
      "1-earthdatalogin_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}